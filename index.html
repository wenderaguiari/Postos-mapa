<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <title>Mapa de Postos - Alloha Frotas</title>

  <!-- Fonte parecida com o Power BI -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;600&display=swap" rel="stylesheet" />

  <!-- PapaParse para ler o CSV direto do GitHub -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <style>
    :root {
      --azul-escuro: #001059;
      --azul-medio: #102a83;
      --azul-claro: #e4ebff;
      --verde: #48ef6c;
      --cinza-bg: #f6f8fb;
      --cinza-borda: #dde2f2;
      --texto-principal: #111827;
      --texto-suave: #6b7280;
      --vermelho: #ef4444;
      --laranja: #f97316;
      --amarelo: #facc15;
      --azul-status: #3b82f6;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: "Segoe UI", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--cinza-bg);
      color: var(--texto-principal);
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    /* HEADER */
    header {
      background: var(--azul-escuro);
      color: #fff;
      padding: 10px 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.25);
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .logo {
      height: 40px;
      width: auto;
      object-fit: contain;
    }

    .titulo-header {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .titulo-header h1 {
      margin: 0;
      font-size: 18px;
      font-weight: 600;
    }

    .titulo-header span {
      font-size: 13px;
      color: #c7d2fe;
    }

    .header-right {
      font-size: 13px;
      display: flex;
      flex-direction: column;
      gap: 2px;
      text-align: right;
    }

    .tag-versao {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(72, 239, 108, 0.15);
      color: #bbf7d0;
      font-size: 11px;
      align-self: flex-end;
    }

    /* CONTEÚDO PRINCIPAL */
    main {
      flex: 1;
      padding: 16px 20px 20px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      max-width: 1400px;
      margin: 0 auto;
      width: 100%;
    }

    /* CARD DE FILTROS */
    .card {
      background: #ffffff;
      border-radius: 16px;
      padding: 14px 16px;
      box-shadow: 0 4px 10px rgba(15, 23, 42, 0.08);
      border: 1px solid var(--cinza-borda);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      gap: 10px;
    }

    .card-header h2 {
      margin: 0;
      font-size: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 8px;
      border-radius: 999px;
      background: var(--azul-claro);
      color: var(--azul-escuro);
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }

    .filtros {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .campo {
      display: flex;
      flex-direction: column;
      gap: 4px;
      min-width: 150px;
      flex: 1;
    }

    .campo label {
      font-size: 12px;
      color: var(--texto-suave);
    }

    select,
    input[type="text"] {
      padding: 7px 10px;
      border-radius: 8px;
      border: 1px solid var(--cinza-borda);
      font-size: 13px;
      outline: none;
      background: #f9fafb;
      transition: border-color 0.2s, box-shadow 0.2s, background 0.2s;
    }

    select:focus,
    input[type="text"]:focus {
      border-color: var(--azul-escuro);
      box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.35);
      background: #ffffff;
    }

    .resumo-contagem {
      font-size: 12px;
      color: var(--texto-suave);
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
    }

    .resumo-contagem span {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      padding: 2px 8px;
      border-radius: 999px;
      background: #f9fafb;
      border: 1px solid var(--cinza-borda);
      font-size: 11px;
    }

    /* GRID PRINCIPAL: TABELAS + MAPA */
    .grid {
      display: grid;
      grid-template-columns: 2fr 2fr 2.4fr;
      gap: 12px;
      align-items: stretch;
    }

    @media (max-width: 1100px) {
      .grid {
        grid-template-columns: 1fr;
      }
    }

    .card-titulo {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 6px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 6px;
    }

    .card-subtitulo {
      font-size: 11px;
      color: var(--texto-suave);
      margin-bottom: 8px;
    }

    .badge-status {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      padding: 2px 7px;
      border-radius: 999px;
      font-size: 11px;
      font-weight: 600;
    }

    .badge-bloqueado {
      background: #fef2f2;
      color: #b91c1c;
      border: 1px solid #fecaca;
    }

    .badge-abaixo {
      background: #eff6ff;
      color: #1d4ed8;
      border: 1px solid #bfdbfe;
    }

    .badge-media {
      background: #ecfdf3;
      color: #15803d;
      border: 1px solid #bbf7d0;
    }

    .badge-acima {
      background: #fff7ed;
      color: #c2410c;
      border: 1px solid #fed7aa;
    }

    .badge-muito-acima {
      background: #fef2f2;
      color: #b91c1c;
      border: 1px solid #fecaca;
    }

    .tabela-wrapper {
      border-radius: 12px;
      border: 1px solid var(--cinza-borda);
      overflow: hidden;
      background: #ffffff;
      max-height: 420px;
      display: flex;
      flex-direction: column;
    }

    .tabela-scroll {
      overflow: auto;
      flex: 1;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
    }

    thead {
      background: #f9fafb;
      position: sticky;
      top: 0;
      z-index: 1;
    }

    th,
    td {
      padding: 6px 8px;
      text-align: left;
      border-bottom: 1px solid #eef2ff;
    }

    th {
      font-weight: 600;
      font-size: 11px;
      text-transform: uppercase;
      color: var(--texto-suave);
      letter-spacing: 0.03em;
    }

    tbody tr {
      cursor: pointer;
      transition: background 0.15s;
    }

    tbody tr:nth-child(even) {
      background: #f9fafb;
    }

    tbody tr:hover {
      background: #e0ecff;
    }

    tbody tr.selecionado {
      background: #dbeafe !important;
    }

    .col-nome {
      min-width: 140px;
    }

    .col-endereco {
      min-width: 180px;
    }

    .col-valores {
      text-align: right;
      white-space: nowrap;
    }

    .tag-pequena {
      font-size: 11px;
      color: var(--texto-suave);
    }

    /* MAPA */
    .map-card {
      background: #ffffff;
      border-radius: 16px;
      padding: 12px;
      box-shadow: 0 4px 10px rgba(15, 23, 42, 0.08);
      border: 1px solid var(--cinza-borda);
      display: flex;
      flex-direction: column;
      gap: 8px;
      min-height: 320px;
    }

    .map-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 8px;
    }

    .map-info {
      display: flex;
      flex-direction: column;
      gap: 3px;
    }

    .map-nome {
      font-size: 13px;
      font-weight: 600;
    }

    .map-endereco {
      font-size: 11px;
      color: var(--texto-suave);
    }

    .map-cta {
      font-size: 11px;
      color: var(--azul-escuro);
      display: flex;
      flex-direction: column;
      gap: 4px;
      align-items: flex-end;
    }

    .btn-mapa {
      border: none;
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 11px;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: var(--azul-escuro);
      color: #ffffff;
      box-shadow: 0 2px 6px rgba(15, 23, 42, 0.25);
    }

    .btn-mapa:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      box-shadow: none;
    }

    .map-frame-wrapper {
      border-radius: 14px;
      overflow: hidden;
      border: 1px solid var(--cinza-borda);
      flex: 1;
      min-height: 240px;
    }

    iframe {
      width: 100%;
      height: 100%;
      border: none;
      display: block;
    }

    .map-placeholder {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      color: var(--texto-suave);
      background: repeating-linear-gradient(
        45deg,
        #f3f4ff,
        #f3f4ff 10px,
        #e5e7eb 10px,
        #e5e7eb 20px
      );
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      display: inline-block;
    }

    .dot-bloqueado { background: #ef4444; }
    .dot-muito-acima { background: #b91c1c; }
    .dot-acima { background: #f97316; }
    .dot-media { background: #22c55e; }
    .dot-abaixo { background: #3b82f6; }
  </style>
</head>

<body>
  <header>
    <div class="header-left">
      <!-- ajuste o caminho da logo branca -->
      <img src="logo_alloha_branco.png" alt="Alloha Fibra" class="logo" />
      <div class="titulo-header">
        <h1>Mapa e Performance de Postos</h1>
        <span>Filtros por cidade, UF, nome e endereço • Destaque para postos abaixo da média</span>
      </div>
    </div>
    <div class="header-right">
      <div class="tag-versao">
        <span>●</span>
        <span>Versão piloto</span>
      </div>
      <span>Uso interno • Alloha Frotas</span>
    </div>
  </header>

  <main>
    <!-- FILTROS -->
    <section class="card">
      <div class="card-header">
        <h2>
          Postos de Abastecimento
          <span class="pill">Filtro dinâmico</span>
        </h2>
        <div class="resumo-contagem" id="resumoContagem">
          <!-- preenchido via JS -->
        </div>
      </div>

      <div class="filtros">
        <div class="campo">
          <label for="filtroUf">UF</label>
          <select id="filtroUf">
            <option value="">Todas</option>
          </select>
        </div>
        <div class="campo">
          <label for="filtroCidade">Cidade</label>
          <select id="filtroCidade">
            <option value="">Todas</option>
          </select>
        </div>
        <div class="campo">
          <label for="filtroNome">Pesquisar por nome do posto</label>
          <input type="text" id="filtroNome" placeholder="Ex: POSTO AEROPORTO" />
        </div>
        <div class="campo">
          <label for="filtroEndereco">Pesquisar por logradouro</label>
          <input type="text" id="filtroEndereco" placeholder="Ex: AV. CASTELO BRANCO" />
        </div>
      </div>
    </section>

    <!-- GRID PRINCIPAL: BLOQUEADOS / TABELA / MAPA -->
    <section class="grid">
      <!-- COLUNA 1: BLOQUEADOS -->
      <section class="card">
        <div class="card-titulo">
          <span>Postos Bloqueados</span>
          <span class="badge-status badge-bloqueado">
            <span class="status-dot dot-bloqueado"></span>
            Bloqueado
          </span>
        </div>
        <div class="card-subtitulo">
          Postos sinalizados para <strong>não abastecer</strong>.
        </div>
        <div class="tabela-wrapper">
          <div class="tabela-scroll">
            <table>
              <thead>
                <tr>
                  <th>Nome</th>
                  <th>Cidade / UF</th>
                  <th>Endereço</th>
                  <th class="col-valores">Desvio</th>
                </tr>
              </thead>
              <tbody id="tbodyBloqueados"></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- COLUNA 2: DEMAIS CLASSIFICAÇÕES -->
      <section class="card">
        <div class="card-titulo">
          <span>Postos por classificação</span>
        </div>
        <div class="card-subtitulo">
          <span class="tag-pequena">
            Clique em um posto para visualizar no mapa.  
            No mapa, priorizamos <strong>postos abaixo da média</strong>.
          </span>
        </div>
        <div class="tabela-wrapper">
          <div class="tabela-scroll">
            <table>
              <thead>
                <tr>
                  <th>Nome</th>
                  <th>Status</th>
                  <th>Cidade / UF</th>
                  <th class="col-valores">Desvio</th>
                  <th class="col-valores">R$/L</th>
                </tr>
              </thead>
              <tbody id="tbodyOutros"></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- COLUNA 3: MAPA -->
      <section class="map-card">
        <div class="map-header">
          <div class="map-info">
            <div class="card-titulo">
              <span>Mapa do posto selecionado</span>
            </div>
            <div class="map-nome" id="mapNome">
              Nenhum posto selecionado
            </div>
            <div class="map-endereco" id="mapEndereco">
              Use os filtros e clique em um posto (preferencialmente <strong>abaixo da média</strong>) para visualizar o local no mapa.
            </div>
          </div>
          <div class="map-cta">
            <button class="btn-mapa" id="btnAbrirMaps" disabled>
              Abrir no Google Maps
            </button>
            <span class="tag-pequena">
              No celular, o aplicativo de mapas será aberto automaticamente.
            </span>
          </div>
        </div>
        <div class="map-frame-wrapper">
          <div class="map-placeholder" id="mapPlaceholder">
            Nenhum posto selecionado.
          </div>
          <iframe id="mapFrame" style="display:none;"></iframe>
        </div>
      </section>
    </section>
  </main>

  <script>
    // -----------------------------
    // CONFIGURAÇÃO
    // -----------------------------
    const CSV_FILE = "postos-mapa.csv";

    let postos = [];
    let postosFiltrados = [];
    let postoSelecionado = null;

    const filtroUf = document.getElementById("filtroUf");
    const filtroCidade = document.getElementById("filtroCidade");
    const filtroNome = document.getElementById("filtroNome");
    const filtroEndereco = document.getElementById("filtroEndereco");

    const tbodyBloqueados = document.getElementById("tbodyBloqueados");
    const tbodyOutros = document.getElementById("tbodyOutros");
    const resumoContagem = document.getElementById("resumoContagem");

    const mapNome = document.getElementById("mapNome");
    const mapEndereco = document.getElementById("mapEndereco");
    const mapFrame = document.getElementById("mapFrame");
    const mapPlaceholder = document.getElementById("mapPlaceholder");
    const btnAbrirMaps = document.getElementById("btnAbrirMaps");

    // -----------------------------
    // NORMALIZAR TEXTO
    // -----------------------------
    function norm(str) {
      return (str || "").toString().trim();
    }

    // Identifica grupo com base no texto da coluna "Blacklist"
    function classificarStatus(texto) {
      const t = (texto || "").toString().toLowerCase();

      if (t.includes("bloque")) return "bloqueado";
      if (t.includes("muito acima")) return "muito_acima";
      if (t.includes("acima")) return "acima";
      if (t.includes("abaixo")) return "abaixo";
      if (t.includes("média") || t.includes("media")) return "na_media";
      return "indefinido";
    }

    function formatarDesvio(valor) {
      if (!valor) return "";
      let v = valor.toString().replace("%", "").replace(",", ".").trim();
      const num = parseFloat(v);
      if (isNaN(num)) return valor;
      return num.toFixed(2) + " %";
    }

    function formatarPreco(valor) {
      if (valor === null || valor === undefined || valor === "") return "";
      const num = parseFloat(valor.toString().replace(",", "."));
      if (isNaN(num)) return valor;
      return "R$ " + num.toFixed(2);
    }

    // -----------------------------
    // CARREGAR CSV
    // -----------------------------
    Papa.parse(CSV_FILE, {
      download: true,
      header: true,
      skipEmptyLines: true,
      complete: function(results) {
        postos = results.data.map((row, index) => {
          const nome = norm(row["Nome EC"] || row["Nome"]);
          const uf = norm(row["UF EC"] || row["UF"]);
          const cidade = norm(row["Cidade EC"] || row["Cidade"]);
          const logradouro = norm(row["Logradouro EC"] || row["Logradouro"]);
          const desvio = norm(row["Desvio de Preço (%)"] || row["Desvio"] || row["Desvio (%)"]);
          const blacklist = norm(row["Blacklist"] || row["Status"] || "");
          const preco = norm(row["Preço por Litro"] || row["Preço"] || row["Preco"]);

          return {
            id: index,
            nome,
            uf,
            cidade,
            logradouro,
            desvio,
            blacklist,
            preco,
            grupo: classificarStatus(blacklist)
          };
        });

        preencherFiltros();
        aplicarFiltros();
      },
      error: function(err) {
        console.error("Erro ao carregar CSV:", err);
        alert("Erro ao carregar o arquivo de postos. Verifique o nome do arquivo e tente novamente.");
      }
    });

    // -----------------------------
    // FILTROS
    // -----------------------------
    function preencherFiltros() {
      const ufs = [...new Set(postos.map(p => p.uf).filter(Boolean))].sort();
      const cidades = [...new Set(postos.map(p => p.cidade).filter(Boolean))].sort();

      ufs.forEach(uf => {
        const opt = document.createElement("option");
        opt.value = uf;
        opt.textContent = uf;
        filtroUf.appendChild(opt);
      });

      cidades.forEach(c => {
        const opt = document.createElement("option");
        opt.value = c;
        opt.textContent = c;
        filtroCidade.appendChild(opt);
      });
    }

    filtroUf.addEventListener("change", aplicarFiltros);
    filtroCidade.addEventListener("change", aplicarFiltros);
    filtroNome.addEventListener("input", aplicarFiltros);
    filtroEndereco.addEventListener("input", aplicarFiltros);

    function aplicarFiltros() {
      const ufSel = filtroUf.value;
      const cidadeSel = filtroCidade.value;
      const nomeBusca = filtroNome.value.toLowerCase();
      const endBusca = filtroEndereco.value.toLowerCase();

      postosFiltrados = postos.filter(p => {
        if (ufSel && p.uf !== ufSel) return false;
        if (cidadeSel && p.cidade !== cidadeSel) return false;
        if (nomeBusca && !p.nome.toLowerCase().includes(nomeBusca)) return false;
        if (endBusca && !p.logradouro.toLowerCase().includes(endBusca)) return false;
        return true;
      });

      renderTabelas();
      atualizarResumo();
      limparSelecaoMapaSeNecessario();
    }

    function atualizarResumo() {
      const total = postosFiltrados.length;
      const bloqueados = postosFiltrados.filter(p => p.grupo === "bloqueado").length;
      const abaixo = postosFiltrados.filter(p => p.grupo === "abaixo").length;
      const naMedia = postosFiltrados.filter(p => p.grupo === "na_media").length;
      const acima = postosFiltrados.filter(p => p.grupo === "acima").length;
      const muitoAcima = postosFiltrados.filter(p => p.grupo === "muito_acima").length;

      resumoContagem.innerHTML = `
        <span><strong>${total}</strong> postos filtrados</span>
        <span><span class="status-dot dot-bloqueado"></span> Bloqueados: <strong>${bloqueados}</strong></span>
        <span><span class="status-dot dot-abaixo"></span> Abaixo: <strong>${abaixo}</strong></span>
        <span><span class="status-dot dot-media"></span> Na média: <strong>${naMedia}</strong></span>
        <span><span class="status-dot dot-acima"></span> Acima: <strong>${acima}</strong></span>
        <span><span class="status-dot dot-muito-acima"></span> Muito acima: <strong>${muitoAcima}</strong></span>
      `;
    }

    // -----------------------------
    // RENDERIZAÇÃO DAS TABELAS
    // -----------------------------
    function renderTabelas() {
      tbodyBloqueados.innerHTML = "";
      tbodyOutros.innerHTML = "";

      const bloqueados = postosFiltrados.filter(p => p.grupo === "bloqueado");
      const outros = postosFiltrados.filter(p => p.grupo !== "bloqueado");

      // BLOQUEADOS
      bloqueados.forEach(p => {
        const tr = document.createElement("tr");
        tr.dataset.id = p.id;

        tr.innerHTML = `
          <td class="col-nome">${p.nome}</td>
          <td>${p.cidade} / ${p.uf}</td>
          <td class="col-endereco">${p.logradouro}</td>
          <td class="col-valores">${formatarDesvio(p.desvio)}</td>
        `;

        tr.addEventListener("click", () => selecionarPosto(p));
        tbodyBloqueados.appendChild(tr);
      });

      // OUTROS (na média / acima / muito acima / abaixo)
      outros.forEach(p => {
        const tr = document.createElement("tr");
        tr.dataset.id = p.id;

        const badge = criarBadgeStatus(p.grupo, p.blacklist);

        tr.innerHTML = `
          <td class="col-nome">${p.nome}</td>
          <td>${badge}</td>
          <td>${p.cidade} / ${p.uf}</td>
          <td class="col-valores">${formatarDesvio(p.desvio)}</td>
          <td class="col-valores">${formatarPreco(p.preco)}</td>
        `;

        tr.addEventListener("click", () => selecionarPosto(p));
        tbodyOutros.appendChild(tr);
      });

      // Reaplicar estilo de selecionado
      marcarLinhaSelecionada();
    }

    function criarBadgeStatus(grupo, textoOriginal) {
      let classe = "";
      let label = textoOriginal || "";

      switch (grupo) {
        case "abaixo":
          classe = "badge-abaixo";
          if (!label) label = "Abaixo da média";
          break;
        case "na_media":
          classe = "badge-media";
          if (!label) label = "Na média";
          break;
        case "acima":
          classe = "badge-acima";
          if (!label) label = "Acima da média";
          break;
        case "muito_acima":
          classe = "badge-muito-acima";
          if (!label) label = "Muito acima da média";
          break;
        default:
          classe = "badge-media";
          if (!label) label = "Não classificado";
      }

      return `<span class="badge-status ${classe}">${label}</span>`;
    }

    // -----------------------------
    // MAPA (SEM LAT / LONG)
    // -----------------------------
    function selecionarPosto(posto) {
      postoSelecionado = posto;
      marcarLinhaSelecionada();
      atualizarMapa();
    }

    function marcarLinhaSelecionada() {
      document.querySelectorAll("tbody tr").forEach(tr => {
        tr.classList.remove("selecionado");
      });

      if (!postoSelecionado) return;

      const idSel = postoSelecionado.id;
      document.querySelectorAll(`tbody tr[data-id="${idSel}"]`).forEach(tr => {
        tr.classList.add("selecionado");
      });
    }

    function limparSelecaoMapaSeNecessario() {
      if (!postoSelecionado) return;
      if (!postosFiltrados.find(p => p.id === postoSelecionado.id)) {
        postoSelecionado = null;
        mapNome.textContent = "Nenhum posto selecionado";
        mapEndereco.innerHTML = "Use os filtros e clique em um posto para visualizar o local no mapa.";
        btnAbrirMaps.disabled = true;
        mapFrame.style.display = "none";
        mapPlaceholder.style.display = "flex";
      }
    }

    function atualizarMapa() {
      if (!postoSelecionado) return;

      const enderecoCompleto = `${postoSelecionado.logradouro}, ${postoSelecionado.cidade} - ${postoSelecionado.uf}, Brasil`;

      mapNome.textContent = postoSelecionado.nome;
      mapEndereco.textContent = enderecoCompleto;

      // Só habilita o botão e troca o mapa automaticamente
      // se o posto estiver ABAIXO DA MÉDIA
      const isAbaixo = postoSelecionado.grupo === "abaixo";

      const urlMapsEmbed = "https://www.google.com/maps?q=" +
        encodeURIComponent(enderecoCompleto) +
        "&output=embed";

      const urlMapsDireto = "https://www.google.com/maps/search/?api=1&query=" +
        encodeURIComponent(enderecoCompleto);

      // Atualiza o iframe sempre que selecionar
      mapFrame.src = urlMapsEmbed;
      mapFrame.style.display = "block";
      mapPlaceholder.style.display = "none";

      // Botão "Abrir no Google Maps" funciona sempre,
      // mas se você quiser, pode travar para só abaixo da média:
      // btnAbrirMaps.disabled = !isAbaixo;
      // Para ficar liberado pra todos:
      btnAbrirMaps.disabled = false;

      btnAbrirMaps.onclick = () => {
        window.open(urlMapsDireto, "_blank");
      };
    }
  </script>
</body>
</html>
