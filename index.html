<!-- Código organizado do Painel de Postos - Alloha Fibra -->
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Painel de Postos - Alloha Fibra</title>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- SheetJS para XLSX -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui;
      font-size: 14px;
      background: #f3f6fb;
      color: #001059;
      display: flex;
      height: 100vh;
      overflow: hidden;
    }

    /* Sidebar */
    .sidebar {
      width: 240px;
      background: #001059;
      color: #f9fafb;
      padding: 14px 16px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      box-shadow: 4px 0 10px rgba(0,0,0,0.25);
    }

    .sidebar-logo img {
      max-width: 140px;
      display: block;
      margin: 0 auto 6px;
    }

    .sidebar-title-main { font-size: 16px; font-weight: 600; }
    .sidebar-title-sub { font-size: 12px; opacity: 0.9; margin-bottom: 4px; }

    .tag {
      display: inline-block;
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid #48ef6c;
      color: #48ef6c;
      background: rgba(72,239,108,0.15);
    }

    #statsBox { margin-top: 8px; font-size: 12px; }
    #statsBox span { font-weight: 600; }

    /* Painel principal */
    .main-panel {
      width: 420px;
      background: #fff;
      padding: 10px 14px;
      border-right: 2px solid #001059;
      display: flex;
      flex-direction: column;
      gap: 8px;
      overflow-y: auto;
    }

    h2 { margin: 0 0 4px; font-size: 16px; }
    small { font-size: 12px; color: #6b7280; }

    label { font-size: 12px; font-weight: 600; margin: 6px 0 2px; display: block; }

    select, input[type="text"] {
      width: 100%;
      padding: 6px 9px;
      border-radius: 999px;
      border: 2px solid #001059;
      background: #f9fafb;
      font-size: 13px;
    }

    select:focus, input:focus {
      border-color: #48ef6c;
      background: #fff;
      box-shadow: 0 0 0 2px rgba(72,239,108,0.25);
    }

    .section-card {
      margin-top: 8px;
      background: #f9fafb;
      border-radius: 10px;
      border: 1px solid #e5e7eb;
      padding: 8px;
      font-size: 13px;
    }

    .section-title {
      display: flex;
      align-items: center;
      gap: 4px;
      margin-bottom: 4px;
      font-weight: 600;
    }

    .section-count { font-size: 12px; color: #6b7280; }

    .badge {
      padding: 2px 6px;
      border-radius: 999px;
      font-size: 10px;
      font-weight: 700;
    }

    .badge-abaixo { background: #dcfce7; color: #166534; }
    .badge-media { background: #dbeafe; color: #1d4ed8; }
    .badge-acima { background: #fef9c3; color: #854d0e; }
    .badge-muito { background: #fee2e2; color: #b91c1c; }

    .posto-item {
      padding: 5px 2px;
      border-bottom: 1px dashed #e5e7eb;
      cursor: pointer;
    }

    .posto-item:hover { background: #e5ebff; }

    /* Mapa */
    .map-panel {
      flex: 1;
      padding: 10px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    #map {
      flex: 1;
      border-radius: 12px;
      border: 2px solid #001059;
      overflow: hidden;
    }

    /* Loader */
    .loader {
      position: fixed;
      top: 50%;
      left: 50%;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      border: 4px solid #e5e7eb;
      border-top: 4px solid #48ef6c;
      transform: translate(-50%, -50%);
      animation: spin 1s linear infinite;
      display: none;
      z-index: 999;
    }

    @keyframes spin {
      0% { transform: translate(-50%, -50%) rotate(0deg); }
      100% { transform: translate(-50%, -50%) rotate(360deg); }
    }
  </style>
</head>
<body>

  <div class="loader" id="loader"></div>

  <aside class="sidebar">
    <div class="sidebar-logo"><img src="Imagem1.png" /></div>
    <div class="sidebar-title-main">Painel de Postos</div>
    <div class="sidebar-title-sub">Desvio de Preço & Classificação</div>
    <span class="tag">Alloha Frotas · Uso interno</span>

    <div id="statsBox">
      <div>Abaixo: <span id="statsAbaixo">0</span></div>
      <div>Média: <span id="statsMedia">0</span></div>
      <div>Acima: <span id="statsAcima">0</span></div>
      <div>Muito acima: <span id="statsMuito">0</span></div>
    </div>
  </aside>

  <main class="main-panel">
    <section>
      <h2>Filtros</h2>
      <small>Use os filtros para localizar rapidamente os postos.</small>

      <label>UF</label>
      <select id="filtroUF"><option value="">Todas</option></select>

      <label>Cidade</label>
      <select id="filtroCidade"><option value="">Todas</option></select>

      <label>Mercadoria</label>
      <select id="filtroMercadoria"><option value="">Todas</option></select>

      <label>Nome do posto</label>
      <input type="text" id="filtroNome" placeholder="Digite parte do nome" />

      <label>Endereço</label>
      <input type="text" id="filtroEndereco" placeholder="Digite parte do endereço" />
    </section>

    <section class="section-card" id="cardLista">
      <div class="section-title">
        <span class="badge badge-abaixo">Abaixo</span>
        <span class="badge badge-media">Na média</span>
        Top 10 mais baratos
        <span class="section-count" id="countLista">(0)</span>
      </div>
      <div id="listaPostos"></div>
    </section>

    <section class="section-card" id="cardTabela">
      <div class="section-title">
        <span class="badge badge-acima">Acima</span>
        <span class="badge badge-muito">Muito acima</span>
        Postos com desvio crítico
        <span class="section-count" id="countTabela">(0)</span>
      </div>

      <table>
        <thead>
          <tr>
            <th>Posto</th>
            <th>Cidade/UF</th>
            <th>Desvio (%)</th>
            <th>Preço</th>
            <th>Grupo</th>
          </tr>
        </thead>
        <tbody id="tabelaAcima"></tbody>
      </table>
    </section>
  </main>

  <section class="map-panel">
    <h3>Mapa – Postos abaixo da média</h3>
    <small>Somente os 10 mais baratos aparecem no mapa.</small>
    <div id="map"></div>
  </section>

  <script>
    const XLSX
